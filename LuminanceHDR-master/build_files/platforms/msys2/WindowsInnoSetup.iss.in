; Script initially generated by the Inno Setup Script Wizard.
; Documentation: http://www.jrsoftware.org/ishelp/
;
; This script is used by "Inno Setup" (http://www.jrsoftware.org/) to create a
; setup executable. When the "make install" process ends, double-click on this
; file to load it into Inno Setup, then execute it to create the installer. It
; expects to find all the dependency libs in the root destination folder (the
; one from the 'make install' process), and the usual 'lib' directory.
; Note that all *.dll files will be added, so be careful which DLLs are present
; in the folder before running this script.
;
; This script searches for and bundles all "luminance-hdr*.exe" files, allowing
; you to bundle GUI and CLI versions, a "release" as well as a "debug" version at the same time.
; At least one "luminance-hdr.exe" file is required.
;
; This script is configured to check that the operating system's bit depth is
; the same as that of the executable file.
;
; The IA-64 architecture is not supported.

#define MyAppName "${LHDR_NAME}"
#define MyAppVersion "${GIT_DESCRIBE}"
#define MyAppVersionNumeric "${GIT_NUMERIC_VERSION_ONLY}"
#define MyAppPublisher "${LHDR_VENDOR}"
#define MyAppURL "http://qtpfsgui.sourceforge.net/"
#define MyAppExeName "luminance-hdr.exe"
#define MySourceBasePath "${PROJECT_SOURCE_DIR}"
#define MyBitDepth "${BUILD_BIT_DEPTH}"
#define MyTargetArchitecture "${ARCHITECTURE_ALLOWED}"
#define MyInstallMode "${INSTALL_MODE}"
#define MySystemName "Windows"
#define MySourceLibsDir "${LIBSSRCDIR}"
#define MyQtTrans "${QTTRANS}"
#define MyBranch "${GIT_BRANCH}"
#define MyHuginBinPath "${HUGIN_BIN_DIR}"

[Setup]
; NOTE: The value of AppId uniquely identifies this application.
; Do not use the same AppId value in installers for other applications.
; (To generate a new GUID, click Tools | Generate GUID inside the IDE.)
AppId={#MyAppName}{#MyAppVersion}
AppName={#MyAppName}
AppVersion={#MyAppVersion}
VersionInfoVersion={#MyAppVersionNumeric}
AppPublisher={#MyAppPublisher}
AppPublisherURL={#MyAppURL}
AppSupportURL={#MyAppURL}
AppUpdatesURL={#MyAppURL}
DefaultDirName={pf}\{#MyAppName}\{#MyAppVersion}
DefaultGroupName={#MyAppName}
AllowNoIcons=yes
LicenseFile=LICENSE
OutputDir=..\
OutputBaseFilename=Luminance-HDR_{#MyBranch}_{#MyAppVersion}_{#MySystemName}_{#MyBitDepth}
SetupIconFile={#MySourceBasePath}\program-icons\luminance.ico
;WizardImageFile={#MySourceBasePath}\build_files\platforms\msys2\installerStrip.bmp
WizardImageBackColor=$2A2A2A
Compression=lzma
SolidCompression=yes
ArchitecturesAllowed={#MyTargetArchitecture}
ArchitecturesInstallIn64BitMode={#MyInstallMode}
PrivilegesRequired=none

[Languages]
Name: "english"; MessagesFile: "compiler:Default.isl"
Name: "brazilianportuguese"; MessagesFile: "compiler:Languages\BrazilianPortuguese.isl"
Name: "catalan"; MessagesFile: "compiler:Languages\Catalan.isl"
Name: "corsican"; MessagesFile: "compiler:Languages\Corsican.isl"
Name: "czech"; MessagesFile: "compiler:Languages\Czech.isl"
Name: "danish"; MessagesFile: "compiler:Languages\Danish.isl"
Name: "dutch"; MessagesFile: "compiler:Languages\Dutch.isl"
Name: "finnish"; MessagesFile: "compiler:Languages\Finnish.isl"
Name: "french"; MessagesFile: "compiler:Languages\French.isl"
Name: "german"; MessagesFile: "compiler:Languages\German.isl"
;Name: "greek"; MessagesFile: "compiler:Languages\Greek.isl"
Name: "hebrew"; MessagesFile: "compiler:Languages\Hebrew.isl"
;Name: "hungarian"; MessagesFile: "compiler:Languages\Hungarian.isl"
Name: "italian"; MessagesFile: "compiler:Languages\Italian.isl"
Name: "japanese"; MessagesFile: "compiler:Languages\Japanese.isl"
Name: "norwegian"; MessagesFile: "compiler:Languages\Norwegian.isl"
Name: "polish"; MessagesFile: "compiler:Languages\Polish.isl"
Name: "portuguese"; MessagesFile: "compiler:Languages\Portuguese.isl"
Name: "russian"; MessagesFile: "compiler:Languages\Russian.isl"
;Name: "serbiancyrillic"; MessagesFile: "compiler:Languages\SerbianCyrillic.isl"
;Name: "serbianlatin"; MessagesFile: "compiler:Languages\SerbianLatin.isl"
Name: "slovenian"; MessagesFile: "compiler:Languages\Slovenian.isl"
Name: "spanish"; MessagesFile: "compiler:Languages\Spanish.isl"
Name: "ukrainian"; MessagesFile: "compiler:Languages\Ukrainian.isl"

[Tasks]
Name: "desktopicon"; Description: "{cm:CreateDesktopIcon}"; GroupDescription: "{cm:AdditionalIcons}"; Flags: unchecked
;Name: "desktopicon\common"; Description: "For all users"; GroupDescription: "Additional icons:"; Flags: exclusive
;Name: "desktopicon\user"; Description: "For the current user only"; GroupDescription: "Additional icons:"; Flags: exclusive unchecked
Name: "quicklaunchicon"; Description: "{cm:CreateQuickLaunchIcon}"; GroupDescription: "{cm:AdditionalIcons}"; Flags: unchecked; OnlyBelowVersion: 0,6.1
;Name: regBrowseFolder; Description: "Add ""Browse with RawTherapee"" option to context menu when right-clicking on a folder."; GroupDescription: File extensions:

[Files]
Source: "luminance-hdr*.exe"; DestDir: "{app}"; Flags: ignoreversion
Source: "hdrhtml\*"; DestDir: "{app}\hdrhtml\"; Flags: ignoreversion recursesubdirs createallsubdirs
Source: "help\*"; DestDir: "{app}\help\"; Flags: ignoreversion recursesubdirs createallsubdirs
Source: "i18n\*"; DestDir: "{app}\i18n\"; Flags: ignoreversion recursesubdirs createallsubdirs
Source: "icons\*"; DestDir: "{app}\icons\"; Flags: ignoreversion recursesubdirs createallsubdirs
Source: "imageformats\*"; DestDir: "{app}\imageformats\"; Flags: ignoreversion recursesubdirs createallsubdirs
Source: "platforms\*"; DestDir: "{app}\platforms\"; Flags: ignoreversion recursesubdirs createallsubdirs
Source: "sqldrivers\*"; DestDir: "{app}\sqldrivers\"; Flags: ignoreversion recursesubdirs createallsubdirs
Source: "AUTHORS"; DestDir: "{app}"; Flags: ignoreversion
Source: "LICENSE"; DestDir: "{app}"; Flags: ignoreversion
Source: "Changelog"; DestDir: "{app}"; Flags: ignoreversion
Source: "README.md"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MyHuginBinPath}/align_image_stack.exe"; DestDir: "{app}/hugin"; Flags: ignoreversion
Source: "{#MyHuginBinPath}/*.dll"; Excludes: "wx*.dll"; DestDir: "{app}/hugin"; Flags: ignoreversion

;---- DLLs !  (the Qt5 plugins dll are already copied in the base path
Source: "{#MySourceLibsDir}\qt5concurrent.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\qt5core.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\qt5gui.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\qt5network.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\qt5printsupport.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\qt5sql.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\qt5webkitwidgets.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\qt5widgets.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\qt5winextras.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\qt5xml.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\qt5webkit.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\qt5multimedia.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\qt5multimediawidgets.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\qt5xml.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\qt5positioning.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\qt5qml.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\qt5quick.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\qt5sensors.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\qt5webchannel.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\qt5opengl.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libexiv2.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libgsl-23.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libiex-2_*.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libilmimf-2_*.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libjpeg-8.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\liblcms2-2.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libpng16-16.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libraw-*.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libtiff-5.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libwinpthread-1.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libgcc_s_seh-1.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libgomp-1.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libstdc++-6.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libexpat-1.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libiconv-2.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\zlib1.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libgslcblas-0.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libhalf-2_*.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libilmthread-2_*.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libimath-2_*.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\zlib1.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libjasper-4.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\liblzma-5.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libicuin*.dll"; Excludes: "libicuind*.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libicuuc*.dll"; Excludes: "libicuucd*.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libpcre2-16-0.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libharfbuzz-0.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libicudt*.dll"; Excludes: "libicudtd*.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libdouble-conversion.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libfreetype-6.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libglib-2.0-0.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libgraphite2.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\librtprocess.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libsqlite3-0.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libwebp-7.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libxml2-2.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libxslt-1.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libzstd.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libbz2-1.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libintl-8.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libpcre-1.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MySourceLibsDir}\libcfitsio-3.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "{#MyQtTrans}\qt_*.qm"; Excludes: "qt_help_*.qm"; DestDir: "{app}\i18n"; Flags: ignoreversion

;Source: "gdb.exe"; DestDir: "{app}"; Flags: skipifsourcedoesntexist ignoreversion
; NOTE: Don't use "Flags: ignoreversion" on any shared system files

[Icons]
Name: "{group}\{#MyAppName} {#MyAppVersion}"; Filename: "{app}\{#MyAppExeName}"
Name: "{group}\{cm:ProgramOnTheWeb,{#MyAppName}}"; Filename: "{#MyAppURL}"
Name: "{group}\{cm:UninstallProgram,{#MyAppName}  {#MyAppVersion}}"; Filename: "{uninstallexe}"
;Name: "{commondesktop}\{#MyAppName} {#MyAppVersion}"; Filename: "{app}\bin\{#MyAppExeName}"; Tasks: desktopicon
Name: "{commondesktop}\{#MyAppName} {#MyBranch} {#MyAppVersion}"; Filename: "{app}\{#MyAppExeName}"; Tasks: desktopicon
Name: "{userappdata}\Microsoft\Internet Explorer\Quick Launch\{#MyAppName} {#MyAppVersion}"; Filename: "{app}\{#MyAppExeName}"; Tasks: quicklaunchicon

[Run]
Filename: "{app}\{#MyAppExeName}"; Description: "{cm:LaunchProgram,{#StringChange(MyAppName, '&', '&&')}}"; Flags: nowait postinstall skipifsilent

;[Registry]
;Root: HKCU; Subkey: "SOFTWARE\Classes\Directory\shell\Browse with RawTherapee"; ValueType: string; ValueData: "Browse with RawTherapee"; Flags: uninsdeletekey; Tasks: regBrowseFolder
;Root: HKCU; Subkey: "SOFTWARE\Classes\Directory\shell\Browse with RawTherapee\command"; ValueType: string; ValueData: "{app}\{#MyAppExeName} -w ""%1"""; Flags: uninsdeletekey; Tasks: regBrowseFolder
